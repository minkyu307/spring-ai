<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>로그인 - Spring AI</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
            body {
                font-family: "Google Sans", "Roboto", -apple-system,
                    BlinkMacSystemFont, sans-serif;
                background: #f8f9fa;
                min-height: 100vh;
                color: #202124;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 24px;
            }
            .login-card {
                width: 100%;
                max-width: 400px;
                background: white;
                border: 1px solid #e8eaed;
                border-radius: 12px;
                padding: 32px 28px;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            }
            .login-title {
                font-size: 1.5em;
                font-weight: 500;
                color: #202124;
                margin-bottom: 24px;
                text-align: center;
            }
            .form-group {
                margin-bottom: 16px;
            }
            .form-group label {
                display: block;
                font-size: 0.875em;
                font-weight: 500;
                color: #3c4043;
                margin-bottom: 6px;
            }
            .form-group input {
                width: 100%;
                padding: 12px 14px;
                border: 1px solid #dadce0;
                border-radius: 8px;
                font-size: 0.95em;
                color: #202124;
            }
            .form-group input::placeholder {
                color: #9aa0a6;
            }
            .form-group input:focus {
                outline: none;
                border-color: #1967d2;
            }
            .btn {
                width: 100%;
                padding: 10px 14px;
                border: none;
                border-radius: 8px;
                font-size: 0.9375em;
                font-weight: 500;
                cursor: pointer;
                transition: background 0.2s;
                text-align: center;
                text-decoration: none;
                display: inline-block;
                box-sizing: border-box;
            }
            .btn-login {
                background: #1967d2;
                color: white;
                margin-top: 8px;
                margin-bottom: 10px;
            }
            .btn-login:hover {
                background: #1557b0;
            }
            .btn-signup {
                background: white;
                color: #1967d2;
                border: 1px solid #dadce0;
                margin-bottom: 20px;
            }
            .btn-signup:hover {
                background: #f8f9fa;
            }
            .divider {
                display: flex;
                align-items: center;
                gap: 12px;
                margin: 20px 0;
            }
            .divider::before,
            .divider::after {
                content: "";
                flex: 1;
                height: 1px;
                background: #e8eaed;
            }
            .divider span {
                font-size: 0.8125em;
                color: #5f6368;
            }
            .btn-google {
                background: white;
                color: #3c4043;
                border: 1px solid #dadce0;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 10px;
            }
            .btn-google:hover {
                background: #f8f9fa;
                border-color: #bdc1c6;
            }
            .btn-google svg {
                width: 18px;
                height: 18px;
            }
            .panel {
                display: block;
            }
            .panel.hidden {
                display: none;
            }
            .link-toggle {
                background: none;
                border: none;
                color: #1967d2;
                font-size: 0.9375em;
                font-weight: 500;
                cursor: pointer;
                padding: 0;
                margin-bottom: 20px;
                width: 100%;
            }
            .link-toggle:hover {
                text-decoration: underline;
            }
            .form-group.has-error input {
                border-color: #d93025;
            }
            .form-group .error-msg {
                font-size: 0.8em;
                color: #d93025;
                margin-top: 4px;
            }
            .success-msg {
                font-size: 0.9em;
                color: #1e8e3e;
                background: #e6f4ea;
                padding: 10px 14px;
                border-radius: 8px;
                margin-bottom: 16px;
            }
            .global-error-msg {
                font-size: 0.85em;
                color: #d93025;
                margin-bottom: 12px;
            }
        </style>
    </head>
    <body>
        <div class="login-card">
            <p th:if="${signupSuccess}" class="success-msg" role="alert">
                회원가입이 완료되었습니다. 로그인해 주세요.
            </p>

            <!-- 로그인 패널 -->
            <div
                id="panel-login"
                class="panel"
                th:classappend="${showSignup} ? 'hidden' : ''"
            >
                <h1 class="login-title">로그인</h1>
                <p th:if="${param.error}" class="global-error-msg" role="alert">
                    아이디 또는 비밀번호가 올바르지 않습니다.
                </p>

                <form
                    th:action="@{/login}"
                    method="post"
                    id="form-direct-login"
                    novalidate
                >
                    <div class="form-group" data-field="username">
                        <label for="username">아이디</label>
                        <input
                            type="text"
                            id="username"
                            name="username"
                            placeholder="아이디를 입력하세요"
                            autocomplete="username"
                            required
                            maxlength="64"
                        />
                        <span class="error-msg" aria-live="polite"></span>
                    </div>
                    <div class="form-group" data-field="password">
                        <label for="password">비밀번호</label>
                        <input
                            type="password"
                            id="password"
                            name="password"
                            placeholder="비밀번호를 입력하세요"
                            autocomplete="current-password"
                            required
                        />
                        <span class="error-msg" aria-live="polite"></span>
                    </div>
                    <button type="submit" class="btn btn-login" id="btn-login">
                        로그인
                    </button>
                </form>
                <button
                    type="button"
                    class="btn btn-signup link-toggle"
                    id="btn-show-signup"
                    style="margin-bottom: 20px"
                >
                    회원가입
                </button>

                <div class="divider"><span>또는</span></div>

                <!-- Google OIDC 로그인 (동작) -->
                <a
                    th:href="@{/oauth2/authorization/google}"
                    class="btn btn-google"
                    role="button"
                >
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path
                            fill="#4285F4"
                            d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"
                        />
                        <path
                            fill="#34A853"
                            d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"
                        />
                        <path
                            fill="#FBBC05"
                            d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"
                        />
                        <path
                            fill="#EA4335"
                            d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"
                        />
                    </svg>
                    Google로 로그인
                </a>
            </div>

            <!-- 회원가입 패널 -->
            <div
                id="panel-signup"
                class="panel"
                th:classappend="${showSignup} ? '' : 'hidden'"
            >
                <h1 class="login-title">회원가입</h1>
                <p
                    th:if="${duplicateLoginId}"
                    th:text="${duplicateLoginId}"
                    class="global-error-msg"
                    role="alert"
                ></p>

                <form
                    th:action="@{/signup}"
                    th:object="${signUpRequest}"
                    method="post"
                    id="form-signup"
                    novalidate
                >
                    <div
                        class="form-group"
                        data-field="loginId"
                        th:classappend="${#fields.hasErrors('loginId')} ? 'has-error' : ''"
                    >
                        <label for="signup-loginId">아이디</label>
                        <input
                            type="text"
                            id="signup-loginId"
                            th:field="*{loginId}"
                            placeholder="영문, 숫자, _ 만 사용 (4~64자)"
                            autocomplete="username"
                            maxlength="64"
                        />
                        <span
                            class="error-msg"
                            th:if="${#fields.hasErrors('loginId')}"
                            th:errors="*{loginId}"
                        ></span>
                    </div>
                    <div
                        class="form-group"
                        data-field="username"
                        th:classappend="${#fields.hasErrors('username')} ? 'has-error' : ''"
                    >
                        <label for="signup-username">이름</label>
                        <input
                            type="text"
                            id="signup-username"
                            th:field="*{username}"
                            placeholder="이름 또는 닉네임"
                            autocomplete="name"
                            maxlength="100"
                        />
                        <span
                            class="error-msg"
                            th:if="${#fields.hasErrors('username')}"
                            th:errors="*{username}"
                        ></span>
                    </div>
                    <div
                        class="form-group"
                        data-field="email"
                        th:classappend="${#fields.hasErrors('email')} ? 'has-error' : ''"
                    >
                        <label for="signup-email">이메일</label>
                        <input
                            type="email"
                            id="signup-email"
                            th:field="*{email}"
                            placeholder="example@email.com"
                            autocomplete="email"
                            maxlength="255"
                        />
                        <span
                            class="error-msg"
                            th:if="${#fields.hasErrors('email')}"
                            th:errors="*{email}"
                        ></span>
                    </div>
                    <div
                        class="form-group"
                        data-field="password"
                        th:classappend="${#fields.hasErrors('password')} ? 'has-error' : ''"
                    >
                        <label for="signup-password">비밀번호</label>
                        <input
                            type="password"
                            id="signup-password"
                            th:field="*{password}"
                            placeholder="8자 이상 입력"
                            autocomplete="new-password"
                            maxlength="128"
                        />
                        <span
                            class="error-msg"
                            th:if="${#fields.hasErrors('password')}"
                            th:errors="*{password}"
                        ></span>
                    </div>
                    <div
                        class="form-group"
                        data-field="passwordConfirm"
                        th:classappend="${#fields.hasErrors('passwordConfirm') || #fields.hasErrors('passwordMatch')} ? 'has-error' : ''"
                    >
                        <label for="signup-passwordConfirm"
                            >비밀번호 확인</label
                        >
                        <input
                            type="password"
                            id="signup-passwordConfirm"
                            th:field="*{passwordConfirm}"
                            placeholder="비밀번호 다시 입력"
                            autocomplete="new-password"
                        />
                        <span
                            class="error-msg"
                            th:if="${#fields.hasErrors('passwordConfirm')}"
                            th:errors="*{passwordConfirm}"
                        ></span>
                        <span
                            class="error-msg"
                            th:if="${#fields.hasErrors('passwordMatch')}"
                            th:errors="*{passwordMatch}"
                        ></span>
                    </div>
                    <button
                        type="submit"
                        class="btn btn-login"
                        id="btn-signup-submit"
                    >
                        가입하기
                    </button>
                </form>
                <button
                    type="button"
                    class="btn btn-signup link-toggle"
                    id="btn-show-login"
                >
                    로그인으로 돌아가기
                </button>
            </div>
        </div>

        <script>
            (function () {
                var panelLogin = document.getElementById("panel-login");
                var panelSignup = document.getElementById("panel-signup");

                function clearFormErrors(form) {
                    if (!form) return;
                    form.querySelectorAll(".form-group.has-error").forEach(
                        function (el) {
                            el.classList.remove("has-error");
                            var msg = el.querySelector(".error-msg");
                            if (msg) msg.textContent = "";
                        }
                    );
                }

                function setFieldError(formGroup, message) {
                    formGroup.classList.add("has-error");
                    var msg = formGroup.querySelector(".error-msg");
                    if (msg) msg.textContent = message;
                }

                function validateLoginForm() {
                    var form = document.getElementById("form-direct-login");
                    clearFormErrors(form);
                    var valid = true;
                    var username = document.getElementById("username");
                    var password = document.getElementById("password");
                    var usernameGroup = form.querySelector(
                        "[data-field=username]"
                    );
                    var passwordGroup = form.querySelector(
                        "[data-field=password]"
                    );

                    if (!username.value.trim()) {
                        setFieldError(usernameGroup, "아이디를 입력하세요.");
                        valid = false;
                    } else if (username.value.length > 64) {
                        setFieldError(
                            usernameGroup,
                            "아이디는 64자 이하여야 합니다."
                        );
                        valid = false;
                    }

                    if (!password.value) {
                        setFieldError(passwordGroup, "비밀번호를 입력하세요.");
                        valid = false;
                    }

                    return valid;
                }

                function validateSignupForm() {
                    var form = document.getElementById("form-signup");
                    if (!form) return true;
                    clearFormErrors(form);
                    var valid = true;
                    var loginId = form.querySelector("[name=loginId]");
                    var username = form.querySelector("[name=username]");
                    var email = form.querySelector("[name=email]");
                    var password = form.querySelector("[name=password]");
                    var passwordConfirm = form.querySelector(
                        "[name=passwordConfirm]"
                    );

                    var loginIdGroup = form.querySelector(
                        "[data-field=loginId]"
                    );
                    var usernameGroup = form.querySelector(
                        "[data-field=username]"
                    );
                    var emailGroup = form.querySelector("[data-field=email]");
                    var passwordGroup = form.querySelector(
                        "[data-field=password]"
                    );
                    var passwordConfirmGroup = form.querySelector(
                        "[data-field=passwordConfirm]"
                    );

                    var loginIdVal = loginId.value.trim();
                    if (!loginIdVal) {
                        setFieldError(loginIdGroup, "아이디를 입력하세요.");
                        valid = false;
                    } else if (loginIdVal.length < 4) {
                        setFieldError(
                            loginIdGroup,
                            "아이디는 4자 이상이어야 합니다."
                        );
                        valid = false;
                    } else if (loginIdVal.length > 64) {
                        setFieldError(
                            loginIdGroup,
                            "아이디는 64자 이하여야 합니다."
                        );
                        valid = false;
                    } else if (!/^[a-zA-Z0-9_]+$/.test(loginIdVal)) {
                        setFieldError(
                            loginIdGroup,
                            "아이디는 영문, 숫자, _ 만 사용할 수 있습니다."
                        );
                        valid = false;
                    }

                    var usernameVal = username.value.trim();
                    if (!usernameVal) {
                        setFieldError(usernameGroup, "이름을 입력하세요.");
                        valid = false;
                    } else if (usernameVal.length > 100) {
                        setFieldError(
                            usernameGroup,
                            "이름은 100자 이하여야 합니다."
                        );
                        valid = false;
                    }

                    var emailVal = email.value.trim();
                    if (!emailVal) {
                        setFieldError(emailGroup, "이메일을 입력하세요.");
                        valid = false;
                    } else if (emailVal.length > 255) {
                        setFieldError(
                            emailGroup,
                            "이메일은 255자 이하여야 합니다."
                        );
                        valid = false;
                    } else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailVal)) {
                        setFieldError(
                            emailGroup,
                            "올바른 이메일 형식을 입력하세요."
                        );
                        valid = false;
                    }

                    if (!password.value) {
                        setFieldError(passwordGroup, "비밀번호를 입력하세요.");
                        valid = false;
                    } else if (password.value.length < 8) {
                        setFieldError(
                            passwordGroup,
                            "비밀번호는 8자 이상이어야 합니다."
                        );
                        valid = false;
                    } else if (password.value.length > 128) {
                        setFieldError(
                            passwordGroup,
                            "비밀번호는 128자 이하여야 합니다."
                        );
                        valid = false;
                    }

                    if (!passwordConfirm.value) {
                        setFieldError(
                            passwordConfirmGroup,
                            "비밀번호 확인을 입력하세요."
                        );
                        valid = false;
                    } else if (password.value !== passwordConfirm.value) {
                        setFieldError(
                            passwordConfirmGroup,
                            "비밀번호가 일치하지 않습니다."
                        );
                        valid = false;
                    }

                    return valid;
                }

                document
                    .getElementById("btn-show-signup")
                    .addEventListener("click", function () {
                        clearFormErrors(
                            document.getElementById("form-direct-login")
                        );
                        panelLogin.classList.add("hidden");
                        panelSignup.classList.remove("hidden");
                    });
                document
                    .getElementById("btn-show-login")
                    .addEventListener("click", function () {
                        clearFormErrors(document.getElementById("form-signup"));
                        panelSignup.classList.add("hidden");
                        panelLogin.classList.remove("hidden");
                    });

                document
                    .getElementById("form-direct-login")
                    .addEventListener("submit", function (e) {
                        if (!validateLoginForm()) {
                            e.preventDefault();
                        }
                    });

                document
                    .getElementById("form-signup")
                    .addEventListener("submit", function (e) {
                        if (!validateSignupForm()) {
                            e.preventDefault();
                        }
                    });
            })();
        </script>
    </body>
</html>
